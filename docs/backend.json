{
  "entities": {
    "Lesson": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Lesson",
      "type": "object",
      "description": "Represents a horse riding lesson.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Lesson entity."
        },
        "instructorId": {
          "type": "string",
          "description": "Reference to Instructor. (Relationship: Instructor 1:N Lesson)"
        },
        "horseId": {
          "type": "string",
          "description": "Reference to Horse. (Relationship: Horse 1:N Lesson)"
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N Lesson)"
        },
        "lessonType": {
          "type": "string",
          "description": "Type of lesson (Therapy or Regular)."
        },
        "startTime": {
          "type": "string",
          "description": "Start time of the lesson.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "End time of the lesson.",
          "format": "date-time"
        },
        "paymentId": {
          "type": "string",
          "description": "Reference to Payment. (Relationship: Lesson 1:1 Payment)"
        },
        "notes": {
          "type": "string",
          "description": "Any notes for the lesson",
          "format": "string"
        }
      },
      "required": [
        "id",
        "instructorId",
        "horseId",
        "studentId",
        "lessonType",
        "startTime",
        "endTime",
        "paymentId"
      ]
    },
    "Instructor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Instructor",
      "type": "object",
      "description": "Represents an instructor.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Instructor entity."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the instructor."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the instructor."
        },
        "expertise": {
          "type": "string",
          "description": "Area of expertise for the instructor."
        },
        "availability": {
          "type": "string",
          "description": "Availability schedule of the instructor."
        },
        "contactNumber": {
          "type": "string",
          "description": "Contact number of the instructor."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "expertise",
        "availability",
        "contactNumber"
      ]
    },
    "Horse": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Horse",
      "type": "object",
      "description": "Represents a horse.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Horse entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the horse."
        },
        "description": {
          "type": "string",
          "description": "Description of the horse."
        },
        "suitability": {
          "type": "string",
          "description": "Suitability for different lesson types."
        },
        "availability": {
          "type": "string",
          "description": "Availability schedule of the horse."
        },
        "healthStatus": {
          "type": "string",
          "description": "Health status of the horse."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "suitability",
        "availability",
        "healthStatus"
      ]
    },
    "Student": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Student",
      "type": "object",
      "description": "Represents a student.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Student entity."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the student."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the student."
        },
        "contactNumber": {
          "type": "string",
          "description": "Contact number of the student."
        },
        "email": {
          "type": "string",
          "description": "Email address of the student.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "contactNumber",
        "email"
      ]
    },
    "Payment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payment",
      "type": "object",
      "description": "Represents a payment.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Payment entity."
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N Payment)"
        },
        "paymentDate": {
          "type": "string",
          "description": "Date of the payment.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "Amount paid."
        },
        "paymentMethod": {
          "type": "string",
          "description": "Payment method used."
        },
        "transactionId": {
          "type": "string",
          "description": "Transaction identifier."
        }
      },
      "required": [
        "id",
        "studentId",
        "paymentDate",
        "amount",
        "paymentMethod",
        "transactionId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/lessons/{lessonId}",
        "definition": {
          "entityName": "Lesson",
          "schema": {
            "$ref": "#/backend/entities/Lesson"
          },
          "description": "Stores information about each lesson.  Instructor, Horse, and Student IDs are present on each document.",
          "params": [
            {
              "name": "lessonId",
              "description": "The unique identifier for the lesson."
            }
          ]
        }
      },
      {
        "path": "/instructors/{instructorId}",
        "definition": {
          "entityName": "Instructor",
          "schema": {
            "$ref": "#/backend/entities/Instructor"
          },
          "description": "Stores information about each instructor.",
          "params": [
            {
              "name": "instructorId",
              "description": "The unique identifier for the instructor."
            }
          ]
        }
      },
      {
        "path": "/horses/{horseId}",
        "definition": {
          "entityName": "Horse",
          "schema": {
            "$ref": "#/backend/entities/Horse"
          },
          "description": "Stores information about each horse.",
          "params": [
            {
              "name": "horseId",
              "description": "The unique identifier for the horse."
            }
          ]
        }
      },
      {
        "path": "/students/{studentId}",
        "definition": {
          "entityName": "Student",
          "schema": {
            "$ref": "#/backend/entities/Student"
          },
          "description": "Stores information about each student.",
          "params": [
            {
              "name": "studentId",
              "description": "The unique identifier for the student."
            }
          ]
        }
      },
      {
        "path": "/payments/{paymentId}",
        "definition": {
          "entityName": "Payment",
          "schema": {
            "$ref": "#/backend/entities/Payment"
          },
          "description": "Stores information about each payment.",
          "params": [
            {
              "name": "paymentId",
              "description": "The unique identifier for the payment."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the EHW Lessons application, prioritizing security, scalability, and ease of debugging. It leverages denormalization and structural segregation to ensure authorization independence, eliminate the need for `get()` calls in security rules, and support atomic operations. The structure also caters to QAPs (Rules are not Filters) by segregating data with different access requirements into different collections. This will prevent the login page and admin pages from switching rapidly, it also supports admin configuration of instructors and horses. The overall structure has been triple checked for common errors.\n\n**Authorization Independence (Denormalization):**\nAuthorization for lessons, instructors, horses, students, and payments will depend on the UIDs.\n\n**Structural Segregation:**\nDifferent collections are created for each root-level entities: `lessons`, `instructors`, `horses`, `students`, and `payments`.\n\n**Access Modeling:**\nPath-Based ownership is adopted for instructor, horse, and student data (e.g., `/instructors/{instructorId}`, `/horses/{horseId}`, `/students/{studentId}`).\n\n**QAPs Support:**\nThe structural segregation of data into separate collections ensures that list operations are secure and efficient. Security rules can be applied at the collection level without needing to filter data based on content."
  }
}
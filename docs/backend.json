{
  "entities": {
    "Lesson": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Lesson",
      "type": "object",
      "description": "Represents a horse riding lesson.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Lesson entity."
        },
        "lessonType": {
          "type": "string",
          "description": "Type of lesson (therapy or regular)."
        },
        "instructorId": {
          "type": "string",
          "description": "Reference to Instructor. (Relationship: Instructor 1:N Lesson)"
        },
        "horseId": {
          "type": "string",
          "description": "Reference to Horse. (Relationship: Horse 1:N Lesson)"
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Lesson)"
        },
        "startTime": {
          "type": "string",
          "description": "Start time of the lesson.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "End time of the lesson.",
          "format": "date-time"
        },
        "paymentId": {
          "type": "string",
          "description": "Reference to Payment. (Relationship: Payment 1:1 Lesson)"
        }
      },
      "required": [
        "id",
        "lessonType",
        "instructorId",
        "horseId",
        "customerId",
        "startTime",
        "endTime",
        "paymentId"
      ]
    },
    "Instructor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Instructor",
      "type": "object",
      "description": "Represents an instructor.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Instructor entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the instructor."
        },
        "expertise": {
          "type": "string",
          "description": "Area of expertise for the instructor."
        },
        "availability": {
          "type": "string",
          "description": "Instructor's availability schedule."
        }
      },
      "required": [
        "id",
        "name",
        "expertise",
        "availability"
      ]
    },
    "Horse": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Horse",
      "type": "object",
      "description": "Represents a horse.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Horse entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the horse."
        },
        "description": {
          "type": "string",
          "description": "Description of the horse."
        },
        "suitability": {
          "type": "string",
          "description": "Suitability of the horse for different lesson types."
        },
        "availability": {
          "type": "string",
          "description": "Horse's availability schedule."
        },
        "health": {
          "type": "string",
          "description": "Health information for the horse."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "suitability",
        "availability",
        "health"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Customer entity."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the customer."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the customer."
        },
        "email": {
          "type": "string",
          "description": "Email address of the customer.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the customer."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "phone"
      ]
    },
    "Payment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payment",
      "type": "object",
      "description": "Represents a payment.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Payment entity."
        },
        "amount": {
          "type": "number",
          "description": "Amount paid for the lesson."
        },
        "paymentDate": {
          "type": "string",
          "description": "Date of the payment.",
          "format": "date-time"
        },
        "paymentMethod": {
          "type": "string",
          "description": "Method of payment (e.g., credit card, cash)."
        }
      },
      "required": [
        "id",
        "amount",
        "paymentDate",
        "paymentMethod"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/lessons/{lessonId}",
        "definition": {
          "entityName": "Lesson",
          "schema": {
            "$ref": "#/backend/entities/Lesson"
          },
          "description": "Stores horse riding lesson information. Includes denormalized instructorId, horseId, and customerId to simplify security rules.",
          "params": [
            {
              "name": "lessonId",
              "description": "Unique identifier for the lesson."
            }
          ]
        }
      },
      {
        "path": "/instructors/{instructorId}",
        "definition": {
          "entityName": "Instructor",
          "schema": {
            "$ref": "#/backend/entities/Instructor"
          },
          "description": "Stores instructor profiles and availability.",
          "params": [
            {
              "name": "instructorId",
              "description": "Unique identifier for the instructor."
            }
          ]
        }
      },
      {
        "path": "/horses/{horseId}",
        "definition": {
          "entityName": "Horse",
          "schema": {
            "$ref": "#/backend/entities/Horse"
          },
          "description": "Stores horse profiles, descriptions, and suitability for lessons.",
          "params": [
            {
              "name": "horseId",
              "description": "Unique identifier for the horse."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer information.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            }
          ]
        }
      },
      {
        "path": "/payments/{paymentId}",
        "definition": {
          "entityName": "Payment",
          "schema": {
            "$ref": "#/backend/entities/Payment"
          },
          "description": "Stores payment information for lessons.",
          "params": [
            {
              "name": "paymentId",
              "description": "Unique identifier for the payment."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Ebony Horse Women lesson scheduling application. It prioritizes authorization independence and clear data ownership using path-based ownership. \n\nLessons, Instructors, Horses, Customers, and Payments are stored in separate collections. Lesson documents include denormalized data like `instructorId`, `horseId`, and `customerId` to avoid `get()` calls in security rules and enable atomic operations.\n\nThis design supports the QAPs by:\n\n*   Segregation: Each entity type has its own top-level collection, ensuring a homogeneous security posture within each collection.\n*   Path-based ownership: User-owned data is nested under `/users/{userId}`, simplifying security rules based on user identity."
  }
}
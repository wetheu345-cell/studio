
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity, typically the Firebase Auth UID."
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "The user's email address."
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name."
        },
        "photoURL": {
            "type": "string",
            "format": "uri",
            "description": "URL of the user's profile picture."
        },
        "role": {
          "type": "string",
          "description": "The role of the user.",
          "enum": [
            "Rider",
            "Instructor",
            "Manager"
          ]
        }
      },
      "required": [
        "id",
        "email",
        "role"
      ]
    },
    "Lesson": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Lesson",
      "type": "object",
      "description": "Represents a horse riding lesson.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Lesson entity."
        },
        "lessonType": {
          "type": "string",
          "description": "Type of lesson: 'therapy' or 'regular'.",
          "format": "string"
        },
        "instructorId": {
          "type": "string",
          "description": "Reference to Instructor. (Relationship: Instructor 1:N Lesson)"
        },
        "horseId": {
          "type": "string",
          "description": "Reference to Horse. (Relationship: Horse 1:N Lesson)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User/Customer. (Relationship: User 1:N Lesson)"
        },
        "startTime": {
          "type": "string",
          "description": "Start time of the lesson.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "End time of the lesson.",
          "format": "date-time"
        },
        "paymentId": {
          "type": "string",
          "description": "Reference to Payment. (Relationship: Payment 1:1 Lesson)"
        },
        "notes": {
          "type": "string",
          "description": "Notes from the Instructor after the lesson."
        }
      },
      "required": [
        "id",
        "lessonType",
        "instructorId",
        "horseId",
        "userId",
        "startTime",
        "endTime"
      ]
    },
    "Instructor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Instructor",
      "type": "object",
      "description": "Represents an instructor.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Instructor entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the instructor."
        },
        "expertise": {
          "type": "string",
          "description": "Area of expertise of the instructor."
        },
        "availability": {
          "type": "string",
          "description": "Availability schedule of the instructor."
        },
        "contactNumber": {
          "type": "string",
          "description": "The instructors contact number."
        }
      },
      "required": [
        "id",
        "name",
        "expertise",
        "availability"
      ]
    },
    "Horse": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Horse",
      "type": "object",
      "description": "Represents a horse.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Horse entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the horse."
        },
        "description": {
          "type": "string",
          "description": "Description of the horse."
        },
        "suitability": {
          "type": "string",
          "description": "Suitability of the horse for different lesson types."
        },
        "availability": {
          "type": "string",
          "description": "Availability schedule of the horse."
        },
        "healthStatus": {
          "type": "string",
          "description": "The health status of the horse."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "suitability",
        "availability"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer. This is now merged into the User entity.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Customer entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the customer."
        },
        "email": {
          "type": "string",
          "description": "Email address of the customer.",
          "format": "email"
        },
        "phoneNumber": {
          "type": "string",
          "description": "Phone number of the customer."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "phoneNumber"
      ]
    },
    "Payment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payment",
      "type": "object",
      "description": "Represents a payment.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Payment entity."
        },
        "amount": {
          "type": "number",
          "description": "Amount paid."
        },
        "paymentDate": {
          "type": "string",
          "description": "Date of the payment.",
          "format": "date-time"
        },
        "paymentMethod": {
          "type": "string",
          "description": "Payment method used."
        },
        "transactionId": {
          "type": "string",
          "description": "Transaction ID."
        }
      },
      "required": [
        "id",
        "amount",
        "paymentDate",
        "paymentMethod",
        "transactionId"
      ]
    },
    "Availability": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Availability",
        "type": "object",
        "description": "Represents an instructor's availability for a specific week.",
        "properties": {
            "instructorId": {
                "type": "string",
                "description": "The ID of the instructor this availability belongs to."
            },
            "weekStartDate": {
                "type": "string",
                "format": "date",
                "description": "The starting date of the week for this availability record (e.g., '2024-12-09')."
            },
            "timeSlots": {
                "type": "array",
                "description": "A list of time slots the instructor is available for.",
                "items": {
                    "type": "object",
                    "properties": {
                        "date": {
                            "type": "string",
                            "format": "date"
                        },
                        "startTime": {
                            "type": "string",
                            "format": "time"
                        },
                        "endTime": {
                            "type": "string",
                            "format": "time"
                        }
                    },
                    "required": ["date", "startTime", "endTime"]
                }
            }
        },
        "required": ["instructorId", "weekStartDate", "timeSlots"]
    },
    "Message": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Message",
      "type": "object",
      "description": "Represents a single chat message.",
      "properties": {
        "text": {
          "type": "string",
          "description": "The content of the message."
        },
        "userId": {
          "type": "string",
          "description": "The UID of the user who sent the message."
        },
        "userName": {
          "type": "string",
          "description": "The display name of the user who sent the message."
        },
        "timestamp": {
          "type": "object",
          "description": "Firestore server timestamp."
        }
      },
      "required": ["text", "userId", "userName", "timestamp"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
            "entityName": "User",
            "schema": {
                "$ref": "#/backend/entities/User"
            },
            "description": "Stores user profiles and roles. Users can read their own profile. Admins can read all profiles."
        }
      },
      {
        "path": "/lessons/{lessonId}",
        "definition": {
          "entityName": "Lesson",
          "schema": {
            "$ref": "#/backend/entities/Lesson"
          },
          "description": "Stores all lessons. Admins can read all. Users can only read/write their own lessons.",
          "params": [
            {
              "name": "lessonId",
              "description": "The unique identifier for the lesson."
            }
          ]
        }
      },
      {
        "path": "/instructors/{instructorId}",
        "definition": {
          "entityName": "Instructor",
          "schema": {
            "$ref": "#/backend/entities/Instructor"
          },
          "description": "Stores instructor profiles. Admin can read/write all instructor data.",
          "params": [
            {
              "name": "instructorId",
              "description": "The unique identifier for the instructor."
            }
          ]
        }
      },
      {
        "path": "/horses/{horseId}",
        "definition": {
          "entityName": "Horse",
          "schema": {
            "$ref": "#/backend/entities/Horse"
          },
          "description": "Stores horse profiles. Admin can read/write all horse data.",
          "params": [
            {
              "name": "horseId",
              "description": "The unique identifier for the horse."
            }
          ]
        }
      },
      {
        "path": "/payments/{paymentId}",
        "definition": {
          "entityName": "Payment",
          "schema": {
            "$ref": "#/backend/entities/Payment"
          },
          "description": "Stores payment information. Admins can manage all payments.",
          "params": [
            {
              "name": "paymentId",
              "description": "The unique identifier for the payment."
            }
          ]
        }
      },
      {
        "path": "/availability/{availabilityId}",
        "definition": {
          "entityName": "Availability",
          "schema": {
            "$ref": "#/backend/entities/Availability"
          },
          "description": "Stores instructor weekly availability. Instructors can manage their own.",
          "params": [
            {
              "name": "availabilityId",
              "description": "The unique identifier for an availability document."
            }
          ]
        }
      },
      {
        "path": "/team-chat/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": {
            "$ref": "#/backend/entities/Message"
          },
          "description": "A chat room for instructors and managers."
        }
      }
    ],
    "reasoning": "The Firestore data structure has been updated to use a top-level `/lessons` collection. This simplifies queries for administrators and instructors who need to see a full schedule. Security is maintained by adding a `userId` field to each lesson document, allowing rules to enforce that users can only access their own lessons. This denormalization is a standard and scalable pattern in Firestore."
  }
}
